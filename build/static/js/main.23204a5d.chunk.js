(this["webpackJsonpcode-examples-react"]=this["webpackJsonpcode-examples-react"]||[]).push([[0],{34:function(e,t,s){},35:function(e,t,s){},40:function(e,t,s){"use strict";s.r(t);var o=s(0),n=s.n(o),a=s(7),i=s.n(a),c=(s(34),s(22)),r=s(13),l=s(12),d=s(23),h=s(11),p=s(28),u=s(14),g=s(27),m=s(6);const v="codeEg_react",b=e=>{console.log(e)},j="oauthState";class w{static generateId(){const e=new Uint8Array(((arguments.length>0&&void 0!==arguments[0]?arguments[0]:40)||40)/2);return window.crypto.getRandomValues(e),Array.from(e,(function(e){return"0".concat(e.toString(16)).substr(-2)})).join("")}constructor(e){this.app=e,this.oauthWindow=null}async receiveHash(e){const t=window.config,s=e&&"#access_token="===e.substring(0,14);if(console.log("access token",e),!s)return;var o=e,n=o.match(/scope=([^&]+)/)[1],a=decodeURIComponent(n).replace(/%20/g,"-"),i=o.replace(/scope=([^&]+)/,"scope="+encodeURIComponent(a));if(-1!==i.search(/[^#.\-&=_a-zA-Z0-9]/))return console.error("Potential XSS attack via fragment (#) value: ".concat(i)),void m.b.error("Potential XSS attack via the fragment value. Please login again.",{autoClose:7e3});window.localStorage.getItem(j);const c=/(#access_token=)(.*)(&expires_in=)(.*)(&token_type=)(.*)(&state=)(.*)/.exec(i),r=c[2],l=c[4];window.localStorage.clear(),t.DS_REDIRECT_AUTHENTICATION?window.history.replaceState(null,"",t.DS_APP_URL):this.oauthWindow&&this.oauthWindow.close();let d=new Date;d.setTime(d.getTime()+1e3*(l-600)),this.accessToken=r;const h=m.b.success("Completing the login process...",{autoClose:7e3}),p=await this.fetchUserInfo(),u=p.accounts.filter((e=>e.is_default)),g=u.length>0&&u[0];if(!g){const e="Problem: the user does not have a default account. Contact DocuSign Customer Service to fix.";return b(e),void m.b.error(e,{autoClose:1e4})}let v="https://demo.docusign.net";const w=await this.getExternalAccountId(g.account_id,v);m.b.dismiss(h),this.app.oAuthResults({accessToken:r,expires:d,name:p.name,email:p.email,accountId:g.account_id,externalAccountId:w,accountName:g.account_name,baseUri:v})}startLogin(){const e=window.config,t=w.generateId();let s;window.localStorage.setItem(j,t),s=e.DS_REDIRECT_AUTHENTICATION?e.DS_APP_URL:"".concat(e.DS_APP_URL);const o="".concat(window.config.DS_IDP,"/oauth/auth?")+"response_type=token&"+"scope=".concat(window.config.IMPLICIT_SCOPES,"&")+"client_id=".concat(window.config.DS_CLIENT_ID,"&")+"state=".concat(t,"&")+"redirect_uri=".concat(encodeURIComponent(s));e.DS_REDIRECT_AUTHENTICATION?window.location=o:this.oauthWindow=window.open(o,"_blank")}logout(){const e=window.config,t="".concat(window.config.DS_IDP,"/logout?")+"response_type=token&"+"scope=".concat(e.IMPLICIT_SCOPES,"&")+"client_id=".concat(e.DS_CLIENT_ID,"&")+"redirect_uri=".concat(encodeURIComponent(e.DS_APP_URL),"&")+"response_mode=logout_redirect";window.location=t}async fetchUserInfo(){let e;try{e=await fetch("".concat(window.config.DS_IDP,"/oauth/userinfo"),{headers:new Headers({Authorization:"Bearer ".concat(this.accessToken),Accept:"application/json","X-DocuSign-SDK":v})})}catch(t){const e="Problem while completing login.\nPlease retry.\nError: ".concat(t.toString());return b(e),m.b.error(e,{autoClose:1e4}),null}if(!e||!e.ok){const t="Problem while completing login.\nPlease retry.\nError: ".concat(e.statusText);return b(t),m.b.error(t,{autoClose:1e4}),null}return await e.json()}async getExternalAccountId(e,t){try{const s="".concat(t).concat("/restapi/v2.1","/accounts/").concat(e),o=await fetch(s,{method:"GET",headers:new Headers({Authorization:"Bearer ".concat(this.accessToken),Accept:"application/json","X-DocuSign-SDK":v})});return(o&&o.ok&&await o.json()).externalAccountId}catch(s){return null}}}var I=w,f=s.p+"static/media/anchorfields.228f85c9.pdf";const E="codeEg_react",S="/restapi/v2.1";var x=class{constructor(e){this.app=e,this.sendEnvelope=this.sendEnvelope.bind(this)}async sendEnvelope(){let e=await fetch(f);if(!e||200!==e.status){const e="Could not fetch file ".concat(f);return console.log(e),void m.b.error(e,{autoClose:1e4})}const t=await e.blob(),s=new FileReader;await new Promise((e=>{s.onloadend=e,s.readAsDataURL(t)}));const o=s.result.split(",")[1],n={emailSubject:"Please sign the attached document",status:"sent",recipients:{signers:[{email:this.app.state.formEmail,name:this.app.state.formName,recipientId:"1",tabs:{signHereTabs:[{anchorString:"/sn1/",anchorXOffset:"20",anchorUnits:"pixels"}]}}]},documents:[{name:"anchorfields.pdf",fileExtension:"pdf",documentId:"1",documentBase64:o}]};try{const e="".concat(this.app.state.baseUri).concat(S)+"/accounts/".concat(this.app.state.accountId)+"/envelopes",t=await fetch(e,{method:"POST",body:JSON.stringify(n),headers:new Headers({Authorization:"Bearer ".concat(this.app.state.accessToken),Accept:"application/json","Content-Type":"application/json","X-DocuSign-SDK":E})}),s=t&&t.ok&&await t.json();let o;const a=t.headers,i=a.get("X-RateLimit-Remaining"),c=i?parseInt(i,10):void 0,r=a.get("X-RateLimit-Reset"),l=r?new Date(1e3*parseInt(r,10)):void 0,d=a.get("X-DocuSign-TraceToken")||void 0;return o=t.ok?{success:!0,errorMsg:void 0,envelopeId:s.envelopeId,availableApiRequests:c,apiRequestsReset:l,traceId:d}:{success:!1,errorMsg:t&&await t.text(),envelopeId:void 0,availableApiRequests:c,apiRequestsReset:l,traceId:d},o}catch(a){return{success:!1,errorMsg:"Failed to fetch"===a.message?"Networking error\u2014check your Internet and DNS connections":a.message,envelopeId:void 0,availableApiRequests:void 0,apiRequestsReset:void 0,traceId:void 0}}}async getEnvelope(){try{const e="".concat(this.app.state.baseUri).concat(S)+"/accounts/".concat(this.app.state.accountId)+"/envelopes/".concat(this.app.state.responseEnvelopeId),t=await fetch(e,{method:"GET",headers:new Headers({Authorization:"Bearer ".concat(this.app.state.accessToken),Accept:"application/json","Content-Type":"application/json","X-DocuSign-SDK":E})}),s=t&&t.ok&&await t.json();let o;const n=t.headers,a=n.get("X-RateLimit-Remaining"),i=a?parseInt(a,10):void 0,c=n.get("X-RateLimit-Reset"),r=c?new Date(1e3*parseInt(c,10)):void 0,l=n.get("X-DocuSign-TraceToken")||void 0;return o=t.ok?{success:!0,errorMsg:void 0,resultsEnvelopeJson:s,availableApiRequests:i,apiRequestsReset:r,traceId:l}:{success:!1,errorMsg:t&&await t.text(),resultsEnvelopeJson:void 0,availableApiRequests:i,apiRequestsReset:r,traceId:l},o}catch(e){return{success:!1,errorMsg:"Failed to fetch"===e.message?"Networking error\u2014check your Internet and DNS connections":e.message,resultsEnvelopeJson:void 0,availableApiRequests:void 0,apiRequestsReset:void 0,traceId:void 0}}}},A=(s(35),s(3));class R extends n.a.Component{constructor(e){super(e),this.state={accessToken:void 0,expires:void 0,name:void 0,email:void 0,externalAccountId:void 0,accountName:void 0,accountId:void 0,baseUri:void 0,page:"welcome",working:!1,workingMessage:"",responseErrorMsg:void 0,responseEnvelopeId:void 0,responseAvailableApiRequests:void 0,responseApiRequestsReset:void 0,responseSuccess:void 0,responseTraceId:void 0,resultsEnvelopeJson:void 0,formName:"",formEmail:""},this.oAuthImplicit=new I(this),this.docusign=new x(this),this.logout=this.logout.bind(this),this.startAuthentication=this.startAuthentication.bind(this),this.formNameChange=this.formNameChange.bind(this),this.formEmailChange=this.formEmailChange.bind(this),this.sendEnvelope=this.sendEnvelope.bind(this),this.getEnvelope=this.getEnvelope.bind(this),this.receiveMessage=this.receiveMessage.bind(this)}async componentDidMount(){const e=window.config;if(window.location.search&&"?error=logout_request"===window.location.search&&window.history.replaceState(null,"",e.DS_APP_URL),null!==e&&void 0!==e&&e.DS_REDIRECT_AUTHENTICATION){const e=window.location.hash;if(!e)return;this.setState({working:!0,workingMessage:"Logging in"});var t=e.match(/scope=([^&]+)/)[1],s=decodeURIComponent(t).replace(/%20/g,"-"),o=e.replace(/scope=([^&]+)/,"scope="+encodeURIComponent(s));await this.oAuthImplicit.receiveHash(o),this.setState({working:!1})}else window.addEventListener("message",this.receiveMessage,!1)}async receiveMessage(e){console.log("e data",e);const t=e&&e.data&&e.data.source,s=!(!t||{"react-devtools-inject-backend":!0,"react-devtools-content-script":!0,"react-devtools-detector":!0,"react-devtools-bridge":!0}[t])&&t;if(s&&"oauthResponse"===s){this.setState({working:!0,workingMessage:"Logging in"});const t=e.data&&e.data.hash;await this.oAuthImplicit.receiveHash(t),this.setState({working:!1})}}startAuthentication(){this.oAuthImplicit.startLogin()}checkToken(){return!(!this.state.accessToken||void 0===this.state.expires||new Date>this.state.expires)||(this.clearAuth(),this.setState({page:"welcome",working:!1}),m.b.error("Your login session has ended.\nPlease login again",{autoClose:8e3}),!1)}logout(){this.clearAuth(),this.clearState(),this.setState({page:"welcome"}),m.b.success("You have logged out.",{autoClose:5e3}),this.oAuthImplicit.logout()}clearAuth(){this.setState({accessToken:void 0,expires:void 0,accountId:void 0,externalAccountId:void 0,accountName:void 0,baseUri:void 0,name:void 0,email:void 0})}clearState(){this.setState({formName:"",formEmail:"",working:!1,responseErrorMsg:void 0,responseEnvelopeId:void 0,responseAvailableApiRequests:void 0,responseApiRequestsReset:void 0,responseSuccess:void 0,responseTraceId:void 0,resultsEnvelopeJson:void 0})}oAuthResults(e){console.log("resultsssssss",e),this.setState({accessToken:e.accessToken,expires:e.expires,name:e.name,externalAccountId:e.externalAccountId,email:e.email,accountId:e.accountId,accountName:e.accountName,baseUri:e.baseUri,page:"loggedIn",formName:e.name,formEmail:e.email}),m.b.success("Welcome ".concat(e.name,", you are now logged in"))}formNameChange(e){this.setState({formName:e.target.value})}formEmailChange(e){this.setState({formEmail:e.target.value})}async sendEnvelope(){if(this.setState({responseErrorMsg:void 0,responseEnvelopeId:void 0,responseAvailableApiRequests:void 0,responseApiRequestsReset:void 0,responseSuccess:void 0,responseTraceId:void 0,resultsEnvelopeJson:void 0}),!this.checkToken())return;if(!this.state.formEmail||this.state.formEmail.length<5)return void m.b.error("Problem: Enter the signer's email address");if(!this.state.formName||this.state.formName.length<5)return void m.b.error("Problem: Enter the signer's name");this.setState({working:!0,workingMessage:"Sending envelope"});const e=await this.docusign.sendEnvelope(),{apiRequestsReset:t}=e,s=t?new Date(t):void 0;this.setState({working:!1,responseSuccess:e.success,responseErrorMsg:e.errorMsg,responseEnvelopeId:e.envelopeId,responseAvailableApiRequests:e.availableApiRequests,responseTraceId:e.traceId,responseApiRequestsReset:s})}async getEnvelope(){if(this.setState({responseErrorMsg:void 0,responseEnvelopeId:void 0,responseAvailableApiRequests:void 0,responseApiRequestsReset:void 0,responseSuccess:void 0,responseTraceId:void 0}),!this.checkToken())return;if(!this.state.responseEnvelopeId)return void m.b.error("Problem: First send an envelope");this.setState({working:!0,workingMessage:"Fetching the envelope's status"});const e=await this.docusign.getEnvelope(),{apiRequestsReset:t}=e,s=t?new Date(t):void 0;this.setState({working:!1,responseSuccess:e.success,responseErrorMsg:e.errorMsg,responseAvailableApiRequests:e.availableApiRequests,responseTraceId:e.traceId,resultsEnvelopeJson:e.resultsEnvelopeJson,responseApiRequestsReset:s})}render(){let e,t;switch(this.state.page){case"welcome":default:e=this.Welcome();break;case"loggedIn":e=this.LoggedIn()}t=this.state.accessToken?Object(A.jsxs)(u.a.Text,{children:[this.state.name,Object(A.jsx)("br",{}),this.state.accountName," (",this.state.accountId,")",Object(A.jsx)(g.a,{children:Object(A.jsx)(g.a.Link,{href:"#",onClick:()=>this.logout(),children:"Logout"})})]}):null;const s=Object(A.jsxs)(c.a,{fluid:!0,className:"bodyMargin",style:{display:this.state.working?"block":"none"},children:[Object(A.jsx)(r.a,{className:"justify-content-center",children:Object(A.jsx)("div",{className:"spinner"})}),Object(A.jsx)(r.a,{className:"justify-content-center",children:Object(A.jsxs)("h3",{children:[this.state.workingMessage,"\u2026"]})})]});return Object(A.jsxs)(A.Fragment,{children:[Object(A.jsxs)(u.a,{fixed:"top",bg:"primary",variant:"dark",children:[Object(A.jsx)(u.a.Brand,{children:"DocuSign Code Example"}),Object(A.jsx)(u.a.Toggle,{}),Object(A.jsx)(u.a.Collapse,{className:"justify-content-end",children:t})]}),Object(A.jsx)(m.a,{}),s,e]})}LoggedIn(){const e=this.state.responseApiRequestsReset,t=e?new Intl.DateTimeFormat("en-US",{dateStyle:"medium",timeStyle:"full"}).format(e):void 0;return Object(A.jsxs)(c.a,{className:"bodyMargin",children:[Object(A.jsx)(r.a,{children:Object(A.jsxs)(l.a,{className:"col-md-4",children:[Object(A.jsx)("h2",{children:"Send an Envelope"}),Object(A.jsxs)(h.a,{children:[Object(A.jsxs)(h.a.Group,{controlId:"formName",children:[Object(A.jsx)(h.a.Label,{children:"Name"}),Object(A.jsx)(h.a.Control,{type:"text",placeholder:"Name",value:this.state.formName,onChange:this.formNameChange})]}),Object(A.jsxs)(h.a.Group,{controlId:"formEmail",children:[Object(A.jsx)(h.a.Label,{children:"Email"}),Object(A.jsx)(h.a.Control,{type:"email",placeholder:"Email",value:this.state.formEmail,onChange:this.formEmailChange})]}),Object(A.jsx)(d.a,{variant:"primary",onClick:this.sendEnvelope,children:"Send Envelope"}),Object(A.jsx)(d.a,{variant:"primary",className:"ml-4",onClick:this.getEnvelope,children:"Get Envelope Status"})]})]})}),Object(A.jsx)(r.a,{className:"mt-4",children:Object(A.jsxs)(l.a,{children:[Object(A.jsx)("h2",{children:"Results"}),Object(A.jsx)("h2",{children:void 0!==this.state.responseSuccess?this.state.responseSuccess?Object(A.jsx)(A.Fragment,{children:"\u2705 Success!"}):Object(A.jsx)(A.Fragment,{children:"\u274c Problem!"}):null}),this.state.responseErrorMsg?Object(A.jsxs)("p",{children:["Error message: ",this.state.responseErrorMsg]}):null,this.state.responseEnvelopeId?Object(A.jsxs)("p",{children:["Envelope ID: ",this.state.responseEnvelopeId]}):null,this.state.resultsEnvelopeJson?Object(A.jsx)("p",{children:Object(A.jsxs)("pre",{children:["Response: ",JSON.stringify(this.state.resultsEnvelopeJson,null,4)]})}):null,this.state.responseAvailableApiRequests?Object(A.jsxs)("p",{children:["Available API requests: ",this.state.responseAvailableApiRequests]}):null,t?Object(A.jsxs)("p",{children:["API requests reset time: ",t]}):null,this.state.responseTraceId?Object(A.jsxs)("p",{children:["Trace ID: ",this.state.responseTraceId,". Please include with all customer service questions."]}):null]})})]})}Welcome(){return Object(A.jsx)(c.a,{fluid:!0,className:"welcomeMargin",children:Object(A.jsx)(r.a,{children:Object(A.jsx)(l.a,{children:Object(A.jsxs)(p.a,{children:[Object(A.jsx)("h1",{children:"React Example with OAuth Authentication"}),Object(A.jsx)("p",{children:"OAuth Implicit grant flow."}),Object(A.jsx)("p",{children:"A better Way to Do signature."}),Object(A.jsx)("p",{children:"Login with your DocuSign Developer (Demo) credentials."}),Object(A.jsx)("p",{children:Object(A.jsx)(d.a,{variant:"primary",onClick:this.startAuthentication,children:"Login"})})]})})})})}}var k=R;var O=e=>{e&&e instanceof Function&&s.e(3).then(s.bind(null,42)).then((t=>{let{getCLS:s,getFID:o,getFCP:n,getLCP:a,getTTFB:i}=t;s(e),o(e),n(e),a(e),i(e)}))},T=s(29);i.a.render(Object(A.jsx)(n.a.StrictMode,{children:Object(A.jsx)(T.a,{children:Object(A.jsx)(k,{})})}),document.getElementById("root")),O()}},[[40,1,2]]]);
//# sourceMappingURL=main.23204a5d.chunk.js.map